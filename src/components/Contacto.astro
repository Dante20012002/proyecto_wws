---
interface Props {
  socialLinks: Array<{
    icon: string;
    href: string;
    alt: string;
  }>;
}

const { socialLinks } = Astro.props;
---


<style>
  .custom-div-icon {
    background: none !important;
    border: none !important;
  }
  .custom-div-icon svg {
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
  }
</style>

<section class="w-full bg-white py-8 md:py-12" id="contacto">
  <div class="max-w-6xl mx-auto px-2 sm:px-4">
    <div class="flex flex-col md:flex-row rounded-lg overflow-hidden shadow-lg">
      <!-- Lado izquierdo: info de contacto -->
      <div
        class="bg-[#4F6E6E] text-white flex-1 flex flex-col gap-4 p-6 md:p-8 relative min-w-[300px]"
      >
        <h4 class="font-bold text-xl md:text-2xl mb-2">Otros medios de contacto</h4>
        <div class="flex items-center gap-3 text-base md:text-lg">
          <svg class="w-8 h-8 text-white" viewBox="0 0 41 57" fill="currentColor" aria-hidden="true">
            <path d="M0.791672 7.125C0.791672 3.19512 4.00547 0 7.95834 0H33.0417C36.9945 0 40.2083 3.19512 40.2083 7.125V49.875C40.2083 53.8049 36.9945 57 33.0417 57H7.95834C4.00547 57 0.791672 53.8049 0.791672 49.875V7.125ZM24.0833 49.875C24.0833 48.9302 23.7058 48.024 23.0338 47.3559C22.3618 46.6878 21.4504 46.3125 20.5 46.3125C19.5496 46.3125 18.6382 46.6878 17.9662 47.3559C17.2942 48.024 16.9167 48.9302 16.9167 49.875C16.9167 50.8198 17.2942 51.726 17.9662 52.3941C18.6382 53.0622 19.5496 53.4375 20.5 53.4375C21.4504 53.4375 22.3618 53.0622 23.0338 52.3941C23.7058 51.726 24.0833 50.8198 24.0833 49.875ZM33.0417 7.125H7.95834V42.75H33.0417V7.125Z"/>
          </svg>
          <a href="tel:+573115327548" class="hover:opacity-80 transition-opacity">+57 3115327548</a>
        </div>
        <div class="flex items-center gap-3 text-base md:text-lg">
          <svg class="w-8 h-8" viewBox="0 0 46 36" fill="currentColor" aria-hidden="true">
            <path d="M4.3125 0.75C1.93164 0.75 0 2.68164 0 5.0625C0 6.41914 0.637891 7.69492 1.725 8.5125L21.275 23.175C22.2992 23.9387 23.7008 23.9387 24.725 23.175L44.275 8.5125C45.3621 7.69492 46 6.41914 46 5.0625C46 2.68164 44.0684 0.75 41.6875 0.75H4.3125ZM0 10.8125V29.5C0 32.6715 2.57852 35.25 5.75 35.25H40.25C43.4215 35.25 46 32.6715 46 29.5V10.8125L26.45 25.475C24.4016 27.0113 21.5984 27.0113 19.55 25.475L0 10.8125Z" fill="currentColor"/>
          </svg>
          <a href="mailto:waterwiseservices@gmail.com" class="hover:opacity-80 transition-opacity">waterwiseservices@gmail.com</a>
        </div>
        <div class="flex items-center gap-3 text-base md:text-lg">
          <svg class="w-8 h-8" viewBox="0 0 38 50" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21.3453 48.75C26.4219 42.4805 38 27.2852 38 18.75C38 8.39844 29.4896 0 19 0C8.51042 0 0 8.39844 0 18.75C0 27.2852 11.5781 42.4805 16.6547 48.75C17.8719 50.2441 20.1281 50.2441 21.3453 48.75ZM19 12.5C20.6797 12.5 22.2906 13.1585 23.4783 14.3306C24.6661 15.5027 25.3333 17.0924 25.3333 18.75C25.3333 20.4076 24.6661 21.9973 23.4783 23.1694C22.2906 24.3415 20.6797 25 19 25C17.3203 25 15.7094 24.3415 14.5217 23.1694C13.3339 21.9973 12.6667 20.4076 12.6667 18.75C12.6667 17.0924 13.3339 15.5027 14.5217 14.3306C15.7094 13.1585 17.3203 12.5 19 12.5Z" fill="currentColor"/>
          </svg>            
          <span>Avenida 6 # 14N - 31</span>
        </div>
        <!-- Mapa interactivo -->
        <div id="wws-map" class="rounded-lg w-full h-32 sm:h-36 md:h-40 object-cover my-2 cursor-pointer z-0 min-h-[128px] min-w-[200px]" style="min-height:128px;min-width:200px;"></div>
        <!-- Redes sociales en círculos -->
        <div class="flex gap-6 mt-2 mb-4 justify-center md:justify-start">
          {socialLinks.map((link) => (
            <a 
              href={link.href} 
              target="_blank" 
              rel="noopener noreferrer" 
              class="group rounded-full bg-white w-12 h-12 flex items-center justify-center shadow hover:bg-[#EAEAEA] transition"
              aria-label={link.alt}
            >
              <svg class="w-7 h-7 text-[#4F6E6E] group-hover:scale-110 transition-transform" aria-hidden="true">
                <use href={link.icon} />
              </svg>
            </a>
          ))}
        </div>
        <!-- Logo splash debajo de las redes -->
        <div class="flex justify-center mt-4">
          <svg class="w-32 md:w-40 opacity-20 select-none pointer-events-none" aria-hidden="true">
            <use href="/assets/sprite.svg#logo-splash" />
          </svg>
        </div>
      </div>
      <!-- Lado derecho: formulario -->
      <div class="bg-white flex-1 flex flex-col p-6 md:p-10 justify-center">
        <div class="mb-2">
          <div class="text-[#7CA0C4] font-bold text-lg md:text-xl text-center md:text-left">
            ¿Necesitas ayuda?
          </div>
          <h2
            class="text-[#4F6E6E] font-extrabold text-3xl md:text-5xl text-center md:text-left leading-tight"
          >
            Contáctanos
          </h2>
        </div>
        <form 
          class="mt-6 flex flex-col gap-6 w-full max-w-2xl mx-auto"
          action="https://formspree.io/f/xanjqoww"
          method="POST"
        >
          <input type="hidden" name="_subject" value="Nuevo contacto desde WWS" />
          <input type="hidden" name="_replyto" value="%email%" />
          <input type="hidden" name="_next" value="https://waterwiseservices.com/gracias" />
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="flex flex-col">
              <label class="text-[#4F6E6E] text-base mb-1" for="nombre">Nombre</label>
              <input
                id="nombre"
                name="nombre"
                type="text"
                required
                class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400"
                placeholder="Tu nombre completo"
                aria-required="true"
              />
            </div>
            <div class="flex flex-col">
              <label class="text-[#4F6E6E] text-base mb-1" for="ciudad">Ciudad</label>
              <input
                id="ciudad"
                name="ciudad"
                type="text"
                required
                class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400"
                placeholder="Tu ciudad"
                aria-required="true"
              />
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="flex flex-col">
              <label class="text-[#4F6E6E] text-base mb-1" for="email">Correo</label>
              <input
                id="email"
                name="email"
                type="email"
                required
                pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400"
                placeholder="tu@email.com"
                aria-required="true"
              />
            </div>
            <div class="flex flex-col">
              <label class="text-[#4F6E6E] text-base mb-1" for="telefono">Teléfono</label>
              <input
                id="telefono"
                name="telefono"
                type="tel"
                required
                pattern="[0-9]{10}"
                class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400"
                placeholder="Tu número de teléfono"
                aria-required="true"
              />
            </div>
          </div>
          <div class="flex flex-col">
            <label class="text-[#4F6E6E] text-base mb-1" for="mensaje">Mensaje</label>
            <textarea
              id="mensaje"
              name="mensaje"
              rows="3"
              required
              class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400 resize-none"
              placeholder="¿En qué podemos ayudarte?"
              aria-required="true"
            ></textarea>
          </div>
          <div class="flex justify-center mt-4">
            <button
              type="submit"
              class="bg-[#EAEAEA] text-[#4F6E6E] rounded font-extrabold text-xl px-10 py-3 shadow-lg hover:bg-[#d1d5db] transition-colors"
              aria-label="Enviar mensaje"
            >
              Enviar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
if (typeof window !== 'undefined') {
  // Solo carga Leaflet cuando el mapa entra en pantalla
  const mapContainer = document.getElementById('wws-map');
  let mapLoaded = false;
  if (mapContainer) {
    const observer = new window.IntersectionObserver((entries) => {
      entries.forEach(async (entry) => {
        if (entry.isIntersecting && !mapLoaded) {
          mapLoaded = true;
          // Importa Leaflet dinámicamente
          await import('leaflet/dist/leaflet.css');
          const L = (await import('leaflet')).default;
          
          // Usar icono SVG que es más confiable en producción
          const svgIcon = L.divIcon({
            html: `<svg width="25" height="41" viewBox="0 0 25 41" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.5 0C5.6 0 0 5.6 0 12.5c0 10.9 12.5 28.5 12.5 28.5S25 23.4 25 12.5C25 5.6 19.4 0 12.5 0z" fill="#4F6E6E"/>
              <circle cx="12.5" cy="12.5" r="4" fill="white"/>
            </svg>`,
            className: 'custom-div-icon',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34]
          });
          
          const map = L.map('wws-map', {
            center: [3.4578939885328484, -76.53301965825993],
            zoom: 16,
            zoomControl: false,
            attributionControl: false,
            dragging: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            keyboard: false,
          });
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
          }).addTo(map);
          
          const marker = L.marker([3.4578939885328484, -76.53301965825993], { icon: svgIcon }).addTo(map);
          map.on('click', () => {
            window.open('https://www.google.com/maps?q=3.4578939885328484,-76.53301965825993', '_blank');
          });
          observer.disconnect();
        }
      });
    }, { threshold: 0.1 });
    observer.observe(mapContainer);
  }
}
</script>

