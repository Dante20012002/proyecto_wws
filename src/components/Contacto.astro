---
interface Props {
  socialLinks: Array<{
    icon: string;
    href: string;
    alt: string;
  }>;
}

const { socialLinks } = Astro.props;
---

<section class="w-full bg-white py-8 md:py-12">
  <div class="max-w-6xl mx-auto px-2 sm:px-4">
    <div class="flex flex-col md:flex-row rounded-lg overflow-hidden shadow-lg">
      <!-- Lado izquierdo: info de contacto -->
      <div
        class="bg-[#4F6E6E] text-white flex-1 flex flex-col gap-4 p-6 md:p-8 relative min-w-[300px]"
      >
        <h4 class="font-bold text-xl md:text-2xl mb-2">Otros medios de contacto</h4>
        <div class="flex items-center gap-3 text-base md:text-lg">
          <span class="material-icons text-3xl" aria-hidden="true">phone_iphone</span>
          <a href="tel:+573115327548" class="hover:opacity-80 transition-opacity">+57 3115327548</a>
        </div>
        <div class="flex items-center gap-3 text-base md:text-lg">
          <span class="material-icons text-3xl" aria-hidden="true">email</span>
          <a href="mailto:waterwiseservices@gmail.com" class="hover:opacity-80 transition-opacity">waterwiseservices@gmail.com</a>
        </div>
        <div class="flex items-center gap-3 text-base md:text-lg">
          <span class="material-icons text-3xl" aria-hidden="true">location_on</span>
          <span>Avenida 6 # 14N - 31</span>
        </div>
        <!-- Mapa interactivo -->
        <div id="wws-map" class="rounded-lg w-full h-32 sm:h-36 md:h-40 object-cover my-2 cursor-pointer z-0 min-h-[128px] min-w-[200px]" style="min-height:128px;min-width:200px;"></div>
        <!-- Redes sociales en círculos -->
        <div class="flex gap-6 mt-2 mb-4 justify-center md:justify-start">
          {socialLinks.map((link) => (
            <a 
              href={link.href} 
              target="_blank" 
              rel="noopener noreferrer" 
              class="group rounded-full bg-white w-12 h-12 flex items-center justify-center shadow hover:bg-[#EAEAEA] transition"
              aria-label={link.alt}
            >
              <svg class="w-7 h-7 text-[#4F6E6E] group-hover:scale-110 transition-transform" aria-hidden="true">
                <use href={link.icon} />
              </svg>
            </a>
          ))}
        </div>
        <!-- Logo splash debajo de las redes -->
        <div class="flex justify-center mt-4">
          <svg class="w-32 md:w-40 opacity-20 select-none pointer-events-none" aria-hidden="true">
            <use href="/assets/sprite.svg#logo-splash" />
          </svg>
        </div>
      </div>
      <!-- Lado derecho: formulario -->
      <div class="bg-white flex-1 flex flex-col p-6 md:p-10 justify-center">
        <div class="mb-2">
          <div class="text-[#7CA0C4] font-bold text-lg md:text-xl text-center md:text-left">
            ¿Necesitas ayuda?
          </div>
          <h2
            class="text-[#4F6E6E] font-extrabold text-3xl md:text-5xl text-center md:text-left leading-tight"
          >
            Contáctanos
          </h2>
        </div>
        <form 
          class="mt-6 flex flex-col gap-6 w-full max-w-2xl mx-auto"
          action="/api/contacto"
          method="POST"
        >
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="flex flex-col">
              <label class="text-[#4F6E6E] text-base mb-1" for="nombre">Nombre</label>
              <input
                id="nombre"
                name="nombre"
                type="text"
                required
                class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400"
                placeholder="Tu nombre completo"
                aria-required="true"
              />
            </div>
            <div class="flex flex-col">
              <label class="text-[#4F6E6E] text-base mb-1" for="ciudad">Ciudad</label>
              <input
                id="ciudad"
                name="ciudad"
                type="text"
                required
                class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400"
                placeholder="Tu ciudad"
                aria-required="true"
              />
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="flex flex-col">
              <label class="text-[#4F6E6E] text-base mb-1" for="correo">Correo</label>
              <input
                id="correo"
                name="correo"
                type="email"
                required
                pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400"
                placeholder="tu@email.com"
                aria-required="true"
              />
            </div>
            <div class="flex flex-col">
              <label class="text-[#4F6E6E] text-base mb-1" for="telefono">Teléfono</label>
              <input
                id="telefono"
                name="telefono"
                type="tel"
                required
                pattern="[0-9]{10}"
                class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400"
                placeholder="Tu número de teléfono"
                aria-required="true"
              />
            </div>
          </div>
          <div class="flex flex-col">
            <label class="text-[#4F6E6E] text-base mb-1" for="mensaje">Mensaje</label>
            <textarea
              id="mensaje"
              name="mensaje"
              rows="3"
              required
              class="border-0 border-b-2 border-[#4F6E6E] bg-transparent focus:ring-0 focus:border-[#7CA0C4] text-[#4F6E6E] placeholder-gray-400 resize-none"
              placeholder="¿En qué podemos ayudarte?"
              aria-required="true"
            ></textarea>
          </div>
          <div class="flex justify-center mt-4">
            <button
              type="submit"
              class="bg-[#EAEAEA] text-[#4F6E6E] rounded font-extrabold text-xl px-10 py-3 shadow-lg hover:bg-[#d1d5db] transition-colors"
              aria-label="Enviar mensaje"
            >
              Enviar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
if (typeof window !== 'undefined') {
  // Solo carga Leaflet cuando el mapa entra en pantalla
  const mapContainer = document.getElementById('wws-map');
  let mapLoaded = false;
  if (mapContainer) {
    const observer = new window.IntersectionObserver((entries) => {
      entries.forEach(async (entry) => {
        if (entry.isIntersecting && !mapLoaded) {
          mapLoaded = true;
          // Importa Leaflet dinámicamente
          await import('leaflet/dist/leaflet.css');
          const L = (await import('leaflet')).default;
          const map = L.map('wws-map', {
            center: [3.4578939885328484, -76.53301965825993],
            zoom: 16,
            zoomControl: false,
            attributionControl: false,
            dragging: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            keyboard: false,
          });
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
          }).addTo(map);
          const marker = L.marker([3.4578939885328484, -76.53301965825993]).addTo(map);
          map.on('click', () => {
            window.open('https://www.google.com/maps?q=3.4578939885328484,-76.53301965825993', '_blank');
          });
          observer.disconnect();
        }
      });
    }, { threshold: 0.1 });
    observer.observe(mapContainer);
  }
}
</script>

